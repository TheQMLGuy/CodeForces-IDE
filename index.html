<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codeforces IDE - Web</title>
    <meta name="description"
        content="A sleek Python IDE for Codeforces competitive programming - runs entirely in your browser">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- CodeMirror 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">

    <link rel="stylesheet" href="style.css">

    <!-- Google Identity Services (for Google Sign-In) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- Non-blocking toast container if needed, or just remove loading screen -->


    <!-- Main App -->
    <div id="app" class="app hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <span class="logo">‚ö°</span>
                <h1 class="app-title">Codeforces IDE</h1>

            </div>
            <div class="header-center">
                <!-- Runtime Status and Timer removed -->
            </div>
            <div class="header-right">
                <!-- Sync Status -->
                <!-- Sync Status removed -->

                <!-- Google Sign-In Button -->
                <button class="header-btn google-signin" id="googleSignInBtn" title="Sign in with Google">
                    <svg width="18" height="18" viewBox="0 0 24 24">
                        <path fill="#4285F4"
                            d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                        <path fill="#34A853"
                            d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                        <path fill="#FBBC05"
                            d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                        <path fill="#EA4335"
                            d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                    </svg>
                    <span>Sign In</span>
                </button>

                <!-- User Profile (shown when signed in) -->
                <div id="userProfile" class="user-profile" style="display: none;">
                    <img id="userAvatar" class="user-avatar" src="" alt="User">
                    <span id="userName" class="user-name"></span>
                    <button class="signout-btn" id="signOutBtn" title="Sign Out">‚Ü™</button>
                </div>

                <button class="header-btn" id="themeToggleBtn" title="Toggle Theme">
                    <span id="themeIcon">üåô</span>
                </button>
                <button class="header-btn" id="parseProblemBtn" title="Parse Codeforces Problem">
                    <span>üì•</span> Parse
                </button>
                <button class="header-btn submit-btn" id="submitCodeBtn" title="Submit to Codeforces">
                    <span>üöÄ</span> Submit
                </button>
                <button class="header-btn" id="snippetsBtn" title="Snippets">
                    <span>‚úÇ</span> Snippets
                </button>
                <button class="header-btn" id="saveStateBtn" title="Save Session">
                    <span>üíæ</span> Save
                </button>
                <button class="header-btn" id="loadStateBtn" title="Load Session">
                    <span>üìÇ</span> Load
                </button>
                <button class="header-btn" id="cursorPlacementBtn" title="Custom Cursor Expansion Rules">
                    <span>üìç</span> Placement
                </button>
                <button class="header-btn" id="cursorMovementBtn" title="Custom Alt Movement Shortcuts">
                    <span>üéØ</span> Movement
                </button>
                <input type="file" id="loadStateInput" hidden accept=".json">
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Problem Statement Panel (leftmost) -->
            <div class="problem-panel" id="problemPanel">
                <div class="section-header">
                    <span>üìÑ Problem</span>
                    <div class="problem-actions">
                        <button class="small-btn" id="toggleProblemBtn" title="Toggle panel">‚óÄ</button>
                    </div>
                </div>
                <div class="problem-content" id="problemContent">
                    <textarea id="problemStatement"
                        placeholder="Paste problem statement here or use Parse button to import from Codeforces..."></textarea>
                </div>
            </div>
            <div class="problem-resizer" id="problemResizer"></div>

            <!-- Left Panel: Editor + IO -->
            <div class="left-panel">
                <!-- Editor Section -->
                <div class="editor-section">
                    <div class="panel-header">
                        <div class="quick-actions">
                            <span class="quick-label">+ Add:</span>
                            <button class="quick-btn" data-type="int" title="Integer input">Int</button>
                            <button class="quick-btn" data-type="list" title="List input">List</button>
                            <button class="quick-btn" data-type="str" title="String input">Str</button>
                            <button class="quick-btn" data-type="matrix" title="Matrix input">Matrix</button>
                        </div>
                    </div>
                    <div class="editor-container">
                        <textarea id="codeEditor"># Codeforces Solution
# Type a snippet keyword (like 'inp', 'tc', 'dfs') and press Tab to expand
# Press Shift+Enter to run your code

n = int(input())
arr = list(map(int, input().split()))

print(sum(arr))
</textarea>
                    </div>
                </div>

                <!-- IO Section (below editor) -->
                <div class="io-section">
                    <!-- Input -->
                    <div class="io-box">
                        <div class="section-header">
                            <span>üì• Input</span>
                            <button class="small-btn" id="clearInputBtn">Clear</button>
                        </div>
                        <textarea id="inputArea" class="io-textarea" placeholder="Paste input...">5
1 2 3 4 5</textarea>
                    </div>
                    <!-- Output -->
                    <div class="io-box">
                        <div class="section-header">
                            <span>üì§ Output</span>
                            <div class="exec-stats">
                                <span class="exec-time" id="execTime" title="Execution Time"></span>
                                <span class="exec-memory" id="execMemory" title="Memory Usage"></span>
                            </div>
                        </div>
                        <div id="outputArea" class="output-area">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Variables | Complexity | Test Cases -->
            <div class="resizer" id="resizer"></div>
            <div class="right-panel-grid">
                <!-- Variables Column -->
                <div class="panel-column variables-column">
                    <div class="section-header">
                        <span>üîß Variables</span>
                        <div class="var-actions">
                            <div class="convert-dropdown" id="convertDropdown">
                                <button class="small-btn convert-btn" id="convertBtn"
                                    title="Convert datatype">üîÑ</button>
                                <div class="convert-menu hidden" id="convertMenu">
                                    <button data-type="int">‚Üí int</button>
                                    <button data-type="str">‚Üí str</button>
                                    <button data-type="float">‚Üí float</button>
                                    <button data-type="list">‚Üí list</button>
                                    <button data-type="set">‚Üí set</button>
                                    <button data-type="dict">‚Üí dict</button>
                                    <button data-type="tuple">‚Üí tuple</button>
                                    <button data-type="bool">‚Üí bool</button>
                                </div>
                            </div>
                            <button class="small-btn" id="refreshVarsBtn">‚Üª</button>
                        </div>
                    </div>
                    <div id="variablesPanel" class="variables-panel">
                        <div class="empty-state">No variables</div>
                    </div>
                </div>

                <!-- Multi-line Visualizer Column -->
                <div class="panel-column visualizer-column">
                    <div class="section-header">
                        <span>üìä Iterations</span>
                        <button class="small-btn" id="clearVisualizerBtn" title="Clear">üóë</button>
                    </div>
                    <div id="visualizerPanel" class="visualizer-panel">
                        <div class="empty-state">No loops/recursion detected</div>
                    </div>
                </div>

                <!-- Test Cases Column -->
                <div class="panel-column testcases-column">
                    <div class="section-header">
                        <span>üìã Tests</span>
                        <button class="small-btn" id="addTestCaseBtn">+</button>
                    </div>
                    <div id="testCasesPanel" class="testcases-panel">
                        <!-- Test cases will be populated here -->
                    </div>
                    <div class="testcase-actions">
                        <button class="action-btn primary" id="runAllTestsBtn">‚ñ∂ Run</button>
                        <button class="action-btn" id="stressTestBtn">üé≤</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Snippets Modal -->
        <div id="snippetsModal" class="modal hidden">
            <div class="modal-content snippets-modal">
                <div class="modal-header">
                    <h2>‚úÇ Code Snippets</h2>
                    <div class="modal-actions">
                        <button class="header-btn" id="addSnippetBtn">+ Add Snippet</button>
                        <button class="modal-close" id="closeSnippetsBtn">√ó</button>
                    </div>
                </div>
                <div class="modal-body">
                    <p class="modal-hint">Type keyword and press <kbd>Tab</kbd> to expand. Use <code>`1</code>,
                        <code>`2</code> placeholders with space-separated args: <code>rep 10 arr[i]</code> ‚Üí replaces
                        <code>`1</code>‚Üí10, <code>`2</code>‚Üíarr[i]
                    </p>
                    <div class="snippets-grid" id="snippetsGrid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Snippet Editor Modal -->
        <div id="snippetEditorModal" class="modal hidden">
            <div class="modal-content snippet-editor-modal">
                <div class="modal-header">
                    <h2 id="snippetEditorTitle">Add Snippet</h2>
                    <button class="modal-close" id="closeSnippetEditorBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="snippetKeyword">Keyword (e.g., "dfs", "bs")</label>
                        <input type="text" id="snippetKeyword" placeholder="Enter keyword..." />
                    </div>
                    <div class="form-group">
                        <label for="snippetName">Name (e.g., "DFS Template")</label>
                        <input type="text" id="snippetName" placeholder="Enter name..." />
                    </div>
                    <div class="form-group">
                        <label for="snippetCode">Code</label>
                        <textarea id="snippetCode" rows="10" placeholder="Enter code..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="header-btn" id="cancelSnippetBtn">Cancel</button>
                        <button class="header-btn primary" id="saveSnippetBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Problem Parser Modal -->
        <div id="problemParserModal" class="modal hidden">
            <div class="modal-content problem-parser-modal">
                <div class="modal-header">
                    <h2>üì• Parse Codeforces Problem</h2>
                    <button class="modal-close" id="closeProblemParserBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="problemUrl">Problem URL</label>
                        <div class="url-input-group">
                            <input type="text" id="problemUrl"
                                placeholder="https://codeforces.com/problemset/problem/1/A" />
                            <button class="header-btn primary" id="parseBtn">Parse</button>
                        </div>
                        <p class="form-hint">Paste a Codeforces problem URL to automatically import sample test cases
                        </p>
                    </div>
                    <div id="parseStatus" class="parse-status hidden"></div>
                    <div id="parsedProblem" class="parsed-problem hidden">
                        <div class="problem-header">
                            <h3 id="problemTitle"></h3>
                            <div class="problem-limits">
                                <span id="timeLimit"></span>
                                <span id="memoryLimit"></span>
                            </div>
                        </div>
                        <div id="sampleTests" class="sample-tests"></div>
                        <button class="header-btn primary" id="importTestsBtn">Import Test Cases</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Code Modal -->
        <div id="submitModal" class="modal hidden">
            <div class="modal-content submit-modal">
                <div class="modal-header">
                    <h2>üöÄ Submit to Codeforces</h2>
                    <button class="modal-close" id="closeSubmitBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="submit-info">
                        <p>Code will be copied to clipboard and Codeforces submission page will open in a new tab.</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contestId">Contest ID</label>
                            <input type="text" id="contestId" placeholder="e.g., 1850" />
                        </div>
                        <div class="form-group">
                            <label for="problemLetter">Problem</label>
                            <select id="problemLetter">
                                <option value="A">A</option>
                                <option value="B">B</option>
                                <option value="C">C</option>
                                <option value="D">D</option>
                                <option value="E">E</option>
                                <option value="F">F</option>
                                <option value="G">G</option>
                                <option value="H">H</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="header-btn" id="cancelSubmitBtn">Cancel</button>
                        <button class="header-btn primary" id="copyAndSubmitBtn">üìã Copy & Open Codeforces</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cursor Placement Rules Modal -->
        <div id="cursorPlacementModal" class="modal hidden">
            <div class="modal-content cursor-rules-modal">
                <div class="modal-header">
                    <h2>üìç Cursor Placement Rules</h2>
                    <button class="modal-close" id="closePlacementBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <p class="modal-hint">Define expansion rules with <code>\`1</code>, <code>\`2</code>,
                        <code>\`3</code> for cursor flow when pressing Space.
                    </p>
                    <div id="placementRulesList" class="rules-list"></div>
                    <div class="add-rule-form">
                        <input type="text" id="placementTrigger" placeholder="Trigger (e.g., def)" />
                        <span class="rule-arrow">‚Üí</span>
                        <textarea id="placementTemplate" placeholder="Template (e.g., def \`1(\`2):\n    \`3)"
                            rows="3"></textarea>
                        <button class="header-btn primary" id="addPlacementRuleBtn">+ Add Rule</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cursor Movement Rules Modal -->
        <div id="cursorMovementModal" class="modal hidden">
            <div class="modal-content cursor-rules-modal">
                <div class="modal-header">
                    <h2>üéØ Cursor Movement Rules</h2>
                    <button class="modal-close" id="closeMovementBtn">√ó</button>
                </div>
                <div class="modal-body">
                    <p class="modal-hint">Define Alt+key shortcuts. Press Alt, type command, release Alt to execute.</p>
                    <div id="movementRulesList" class="rules-list"></div>
                    <div class="add-rule-form">
                        <input type="text" id="movementShortcut" placeholder="Shortcut (e.g., 1e)" />
                        <span class="rule-arrow">‚Üí</span>
                        <input type="text" id="movementAction" placeholder="Action (e.g., end of line 1)" />
                        <select id="movementType">
                            <option value="line">Go to line</option>
                            <option value="lineEnd">Go to line end</option>
                            <option value="lineStart">Go to line start</option>
                            <option value="custom">Custom JS</option>
                        </select>
                        <button class="header-btn primary" id="addMovementRuleBtn">+ Add Rule</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alt Command Box (appears when Alt is held) -->
        <div id="altCommandBox" class="alt-command-box hidden">
            <span class="alt-label">Alt +</span>
            <span id="altCommandText" class="alt-command-text"></span>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast hidden"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/search/searchcursor.min.js"></script>
    <script src="auth.js"></script>
    <script src="local-storage.js"></script>
    <script src="firebase-sync.js"></script>
    <script src="app.js"></script>
</body>

</html>